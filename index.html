<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è­·ç†è¨˜éŒ„å¿«æ‰‹</title>
    <!-- 1. å¼•å…¥æ¨£å¼è¡¨ -->
    <link rel="stylesheet" href="style.css">
    <!-- 2. å¼•å…¥è³‡æ–™åº« -->
    <script src="database.js"></script>
</head>
<body>

<div class="container">
    <h1>ğŸ¥ è­·ç†è¨˜éŒ„ç”¢ç”Ÿå™¨</h1>

    <div class="form-group">
        <div class="section-title">Step 1: é¸æ“‡é …ç›®</div>
        <div class="row">
            <select id="mainSelect" onchange="updateCategory()">
                <option value="">ä¸»è™•ç½®...</option>
            </select>
            <select id="catSelect" onchange="updateSubCategory()" disabled>
                <option value="">åˆ†é¡...</option>
            </select>
        </div>
        <div style="margin-top: 15px;">
            <select id="subSelect" onchange="renderVariables()" disabled>
                <option value="">è©³ç´°å…§å®¹...</option>
            </select>
        </div>
    </div>

    <!-- å‹•æ…‹è®Šæ•¸å€ (é è¨­éš±è—) -->
    <div id="variableArea" style="display:none;">
        <div class="section-title">Step 2: å¡«å¯«æ•¸æ“š</div>
        <div id="dynamicInputs"></div>
    </div>

    <div class="form-group">
        <div class="section-title">Step 3: é è¦½èˆ‡ä¿®æ”¹</div>
        <textarea id="resultArea" placeholder="ç³»çµ±å°‡è‡ªå‹•ç”Ÿæˆè¨˜éŒ„..."></textarea>
    </div>

    <button class="btn-primary" onclick="copyText()">ğŸ“‹ è¤‡è£½åˆ°å‰ªè²¼ç°¿</button>
</div>

<div id="toast" class="toast">âœ… å·²è¤‡è£½æˆåŠŸï¼</div>

<script>
    /* é€™è£¡çš„é‚è¼¯ä¸è®Šï¼Œç¶­æŒåŸæœ¬çš„åŠŸèƒ½ */
    const data = window.nursingData || {};
    const mainSelect = document.getElementById('mainSelect');
    const catSelect = document.getElementById('catSelect');
    const subSelect = document.getElementById('subSelect');
    const variableArea = document.getElementById('variableArea');
    const dynamicInputs = document.getElementById('dynamicInputs');
    const resultArea = document.getElementById('resultArea');
    let currentTemplate = "";

    Object.keys(data).forEach(key => mainSelect.add(new Option(key, key)));

    function updateCategory() {
        catSelect.innerHTML = '<option value="">åˆ†é¡...</option>';
        subSelect.innerHTML = '<option value="">è©³ç´°å…§å®¹...</option>';
        catSelect.disabled = true;
        subSelect.disabled = true;
        variableArea.style.display = 'none';
        resultArea.value = '';
        
        if (mainSelect.value && data[mainSelect.value]) {
            catSelect.disabled = false;
            Object.keys(data[mainSelect.value]).forEach(key => catSelect.add(new Option(key, key)));
        }
    }

    function updateSubCategory() {
        subSelect.innerHTML = '<option value="">è©³ç´°å…§å®¹...</option>';
        subSelect.disabled = true;
        variableArea.style.display = 'none';
        resultArea.value = '';

        if (mainSelect.value && catSelect.value) {
            subSelect.disabled = false;
            const items = data[mainSelect.value][catSelect.value];
            Object.keys(items).forEach(key => subSelect.add(new Option(key, items[key])));
        }
    }

    function renderVariables() {
        dynamicInputs.innerHTML = '';
        currentTemplate = subSelect.value;
        resultArea.value = currentTemplate;

        if (!currentTemplate) {
            variableArea.style.display = 'none';
            return;
        }

        const regex = /{{(.*?)}}/g;
        let match;
        const vars = new Set();
        while ((match = regex.exec(currentTemplate)) !== null) vars.add(match[1]);

        if (vars.size > 0) {
            variableArea.style.display = 'block';
            vars.forEach(v => {
                const div = document.createElement('div');
                div.style.marginBottom = "10px";
                div.innerHTML = `<label>${v}</label><input type="text" data-var="${v}" placeholder="è¼¸å…¥${v}..." oninput="generateText()">`;
                dynamicInputs.appendChild(div);
            });
            setTimeout(() => dynamicInputs.querySelector('input').focus(), 100);
        } else {
            variableArea.style.display = 'none';
        }
    }

    function generateText() {
        let text = currentTemplate;
        dynamicInputs.querySelectorAll('input').forEach(input => {
            if (input.value) text = text.split(`{{${input.dataset.var}}}`).join(input.value);
        });
        resultArea.value = text;
    }

    function copyText() {
        const text = resultArea.value;
        if (!text) return;
        navigator.clipboard.writeText(text).then(() => {
            const toast = document.getElementById('toast');
            toast.classList.add('show');
            setTimeout(() => toast.classList.remove('show'), 2000);
        });
    }
</script>
</body>
</html>
